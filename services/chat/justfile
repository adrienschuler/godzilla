set working-directory := '../..'

image := "chat:latest"
deployment := "chat"

test:
    cd services/chat && npm test

lint:
    cd services/chat && npm run lint

format:
    cd services/chat && npm run format

check:
    cd services/chat && npm run lint && npm run format -- --check

build:
    eval $(minikube -p minikube docker-env) && \
    docker build -t {{image}} -f services/chat/Dockerfile .

deploy:
    kubectl delete deployment {{deployment}} --ignore-not-found=true
    kubectl apply -f k8s/chat.yaml

rebuild: test build deploy
    kubectl rollout status deployment/{{deployment}} --timeout=60s
